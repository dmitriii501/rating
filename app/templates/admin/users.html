{% extends "base.html" %}
{% block title %}Админ — Участники{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
	<h1 class="h5">Участники</h1>
	<a class="btn btn-outline-danger" href="{{ url_for('admin.logout') }}">Выйти</a>
	</div>
<div class="row g-3">
	<div class="col-lg-7">
		<div class="p-3 bg-white rounded border">
			<div class="fw-semibold mb-2">Список участников</div>
			<div class="table-responsive">
				<table class="table table-sm align-middle">
					<thead>
					<tr>
						<th>Имя</th>
						<th>Отдел</th>
						<th>Новичок</th>
						<th class="text-end">Действия</th>
					</tr>
					</thead>
					<tbody>
					{% for u in users %}
					<tr>
						<td>{{ u.name }}</td>
						<td>{{ u.department.name if u.department else "-" }}</td>
						<td>{{ "Да" if u.is_newbie else "Нет" }}</td>
						<td class="text-end">
							<form class="d-inline" method="post" action="{{ url_for('admin.delete_user', user_id=u.id) }}">
								<button class="btn btn-sm btn-outline-danger" type="submit">Удалить</button>
							</form>
						</td>
					</tr>
					<tr>
						<td colspan="4">
							<form class="row g-2" method="post" action="{{ url_for('admin.edit_user', user_id=u.id) }}">
								<div class="col-md-4">
									<input class="form-control form-control-sm" type="text" name="name" placeholder="Имя" value="{{ u.name }}">
								</div>
								<div class="col-md-4">
									<select class="form-select form-select-sm" name="department_id">
										<option value="">— Отдел —</option>
										{% for d in departments %}
											<option value="{{ d.id }}" {% if u.department and d.id == u.department.id %}selected{% endif %}>{{ d.name }}</option>
										{% endfor %}
									</select>
								</div>
								<div class="col-md-2">
									<div class="form-check mt-1">
										<input class="form-check-input" type="checkbox" name="is_newbie" {% if u.is_newbie %}checked{% endif %}>
										<label class="form-check-label small">Новичок</label>
									</div>
								</div>
								<div class="col-md-2 text-end">
									<button class="btn btn-sm btn-dark" type="submit">Сохранить</button>
								</div>
							</form>
						</td>
					</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>
			{% if not users %}
				<div class="text-muted">Пока нет участников.</div>
			{% endif %}
		</div>
	</div>
	<div class="col-lg-5">
		<div class="p-3 bg-white rounded border">
			<div class="fw-semibold mb-2">Добавить участника</div>
			<form method="post">
				<div class="mb-2">
					<label class="form-label">Имя</label>
					<input class="form-control" type="text" name="name" required>
				</div>
				<div class="mb-2">
					<label class="form-label">Отдел</label>
					<select class="form-select" name="department_id">
						<option value="">— Не указан —</option>
						{% for d in departments %}
							<option value="{{ d.id }}">{{ d.name }}</option>
						{% endfor %}
					</select>
				</div>
				<div class="mb-2">
					<label class="form-label">Дата вступления</label>
					<input class="form-control" type="date" name="join_date">
				</div>
				<div class="form-check mb-3">
					<input class="form-check-input" type="checkbox" name="is_newbie" checked>
					<label class="form-check-label">Новичок</label>
				</div>
				<button class="btn btn-dark" type="submit">Добавить</button>
			</form>
		</div>
	</div>
</div>
{% endblock %}


